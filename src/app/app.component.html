<mat-toolbar color="primary">
  <span>Realm Forge</span>
  <span class="spacer"></span>
  <div class="auth-toolbar">
    @if (persistence.user(); as user) {
      <span class="auth-status">Signed in as {{ user.email || 'Player' }}</span>
      <button mat-stroked-button color="accent" (click)="signOut()">Log out</button>
    } @else {
      @if (persistence.isAuthLoading()) {
        <span class="auth-status">Authenticating...</span>
      } @else {
        <button mat-flat-button color="accent" type="button" (click)="signInWithGoogle()">Sign in with Google</button>
      }
    }
  </div>
  <button mat-icon-button (click)="saveGame()" title="Save Game">
    <mat-icon>save</mat-icon>
  </button>
  <button mat-icon-button (click)="newGame()" title="New Game">
    <mat-icon>refresh</mat-icon>
  </button>
</mat-toolbar>
@if (!persistence.user() && persistence.authError()) {
  <div class="auth-error">
    {{ persistence.authError() }}
  </div>
}
@if (persistence.userProfile(); as profile) {
  <section class="account-panel">
    <h2>Account</h2>
    <div class="account-row">
      <span class="account-label">Email</span>
      <span>{{ profile.email || 'Unknown' }}</span>
    </div>
    <div class="account-row">
      <span class="account-label">Display name</span>
      <span>{{ profile.displayName || 'Player' }}</span>
    </div>
    <mat-checkbox [checked]="profile.isAdmin" disabled>Administrator</mat-checkbox>
  </section>
}

<div class="game-board" cdkDropListGroup>
  @for (col of columns; track col.id) {
    <div class="board-column"
         cdkDropList
         [cdkDropListData]="col.items"
         (cdkDropListDropped)="drop($event)">

      @for (item of col.items; track item) {
        <div class="board-item" cdkDrag>
           @switch (item) {
             @case ('dm') { <app-dm-card class="card-component"></app-dm-card> }
             @case ('character') { <app-character-card class="card-component"></app-character-card> }
             @case ('dice') { <app-dice-card class="card-component"></app-dice-card> }
             @case ('oracle') { <app-oracle-card class="card-component"></app-oracle-card> }
             @case ('log') { <app-log-card class="card-component"></app-log-card> }
           }

           <div class="drag-handle" cdkDragHandle>
             <mat-icon>drag_indicator</mat-icon>
           </div>
        </div>
      }
    </div>
  }
</div>
