<mat-card class="dm-card">
  <mat-card-header>
    <mat-card-title>Dungeon Master</mat-card-title>
  </mat-card-header>
  <mat-card-content>
    @if (nodeState$ | async; as state) {
      @switch (state.status) {
        @case ('idle') {
          <p>Start a new game to begin your adventure.</p>
        }
        @case ('loading') {
          <p>Loading scene...</p>
        }
        @case ('missing') {
          <p>Node not found: {{ state.nodeId }}</p>
          <button mat-stroked-button color="warn" (click)="resetSession()">Reset</button>
        }
        @case ('ready') {
          <p class="narrative-text">{{ state.node.text }}</p>
          @if (state.node.type === 'combat' || (state.node.monsterIds?.length ?? 0) > 0) {
            <section class="encounter-section">
              <h3>Encounter</h3>
              @if (monsters$ | async; as monsters) {
                @if (monsters.length) {
                  <div class="monster-list">
                    @for (monster of monsters; track monster.id) {
                      <div class="monster-card">
                        <strong>{{ monster.name }}</strong>
                        <div class="monster-stats">
                          <span>HP: {{ monster.stats?.hp ?? '—' }}</span>
                          <span>AC: {{ monster.stats?.ac ?? '—' }}</span>
                        </div>
                      </div>
                    }
                  </div>
                } @else {
                  <p>No monster data found.</p>
                }
              } @else {
                <p>Loading monsters...</p>
              }
            </section>
          }
        }
      }
    }
  </mat-card-content>
  <mat-card-actions align="end" class="actions-container">
    @if (nodeState$ | async; as state) {
      @if (state.status === 'ready' && state.node.options?.length) {
        @for (opt of state.node.options; track opt.nextNode) {
          <button mat-flat-button color="primary" (click)="goToNode(opt.nextNode)">
            {{ opt.text }}
          </button>
        }
      }
    }
  </mat-card-actions>
</mat-card>
